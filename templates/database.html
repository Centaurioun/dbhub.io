<!doctype html>
<html ng-app="DBHub-front" ng-controller="databaseView">
<head>
    <meta charset="UTF-8">
    <title>DBHub.io - [[ .Username ]] / [[ .Database ]]</title>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-sanitize.min.js"></script>
    <script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-2.2.0.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .nav, .pagination, .carousel, .panel-title a { cursor: pointer; }

        #viewupdates, #viewbranches, #viewreleases, #viewcontribs {
            margin-left: 30%;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h2 id="viewuser">
                <div class="pull-left"><a href="/">/</a> <a href="/[[ .Username ]]">[[ .Username ]]</a> / [[ .Database ]]</div>
                <div class="btn-group pull-right">
                    <button type="button" class="btn btn-default" ng-bind="'Watchers: ' + meta.Watchers"></button>
                    <button type="button" class="btn btn-default" ng-bind="'Stars: ' + meta.Stars"></button>
                    <button type="button" class="btn btn-default" ng-bind="'Forks: ' + meta.Forks"></button>
                </div>
            </h2>
        </div>
    </div>
    <div class="row" style="padding-bottom: 5px; padding-top: 10px;">
        <div class="col-md-10">
            <div class="row">
                <div class="col-md-2">
                    Data
                </div>
                <div class="col-md-2">
                    <a href="">Visualise</a>
                </div>
                <div class="col-md-2">
                    <a href="">Schedule</a>
                </div>
                <div class="col-md-2">
                    <label id="viewdiscuss"><a href="">{{ 'Discussions: ' }}</a>{{ meta.Discussions }}</label>
                </div>
                <div class="col-md-2">
                    <label id="viewprs"><a href="">{{ 'Pull Requests: ' }}</a>{{ meta.PRs }}</label>
                </div>
                <div class="col-md-2">
                    &nbsp;
                </div>
            </div>
        </div>
        <div class="col-md-2 pull-right">
            <b>Version:</b> {{ meta.Version }} &nbsp;
            <b>Size:</b> {{ meta.Size / 1024 | number : 0 }} KB
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="well well-sm" style="margin-bottom: 10px;">
                <label id="viewdesc" ng-bind="meta.Description"></label>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table width="100%" class="table table-bordered" style="margin-bottom: 10px;">
                <tr>
                    <td>
                        <label id="viewupdates" ng-bind="'Updates: ' + meta.Updates"></label>
                    </td>
                    <td>
                        <label id="viewbranches" ng-bind="'Branches: ' + meta.Branches"></label>
                    </td>
                    <td>
                        <label id="viewreleases" ng-bind="'Releases: ' + meta.Releases"></label>
                    </td>
                    <td>
                        <label id="viewcontribs" ng-bind="'Contributors: ' + meta.Contributors"></label>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div class="row" style="padding-bottom: 10px;">
        <div class="dropdown col-md-5">
            <div class="btn-group" uib-dropdown keyboard-nav="true">
                <button id="viewtable" type="button" class="btn">{{ 'Table: ' + db.Tablename }}</button>

                <button type="button" uib-dropdown-toggle class="btn btn-default">
                    <span class="caret"></span>
                </button>
                <ul uib-dropdown-menu class="dropdown-menu" role="menu">
                    <li ng-repeat="row in meta.Tables" role="menuitem" ng-click="changeTable(row)">
                        <a href="#{{ row }}">{{ row }}</a>
                    </li>
                </ul>
            </div>
            <button class="btn btn-primary">New Pull Request</button>
        </div>
        <div class="col-md-2" style="vertical-align: text-bottom;">
            &nbsp;
        </div>
        <div class="col-md-5">
            <span class="pull-right">
                <button class="btn btn-primary">Create new database</button>
                <button class="btn btn-primary">Upload database</button>
                <div class="btn-group" uib-dropdown keyboard-nav="true">
                    <button type="button" class="btn btn-success" uib-dropdown-toggle>
                        Download <span class="caret"></span>
                    </button>
                    <ul uib-dropdown-menu class="dropdown-menu" role="menu">
                      <li><a href="/download/[[ .Username ]]/[[ .Database ]]?version=[[ .Version ]]">Entire database</a></li>
                      <li><a href="#">Selected table as CSV</a></li>
                    </ul>
                </div>
            </span>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table class="table table-bordered table-striped table-responsive">
                <tr>
                    <th ng-repeat="header in db.TableHeaders">{{ header }}</th>
                </tr>
                <tr ng-repeat="row in db.Records">
                    <td ng-repeat="val in row"><span ng-bind-html="val.Value | fixSpaces"></span></td>
                </tr>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="page-header">
                <h1>README</h1>
            </div>
            <label id="viewreadme" ng-bind="meta.Readme"></label>
        </div>
    </div>
</div>

<script>
    var app = angular.module('DBHub-front', ['ui.bootstrap', 'ngSanitize']);
    app.filter("fixSpaces", ['$sce', '$sanitize', function($sce, $sanitize) {
        return function(htmlCode){
            if (htmlCode == "") {
                htmlCode = '&nbsp;';
            }
            return $sanitize(htmlCode);
        }
    }]);
    app.controller('databaseView', function($scope, $http) {
        $scope.meta = { Username: "[[ .Username ]]",
            Database: "[[ .Database ]]",
            Watchers: "[[ .Watchers ]]",
            Stars: "[[ .Stars ]]",
            Forks: "[[ .Forks ]]",
            Discussions: "[[ .Discussions ]]",
            PRs: "[[ .PRs ]]",
            Description: "[[ .Description ]]",
            Updates: "[[ .Updates ]]",
            Branches: "[[ .Branches ]]",
            Releases: "[[ .Releases ]]",
            Contributors: "[[ .Contributors ]]",
            Readme: "[[ .Readme ]]",
            Size: "[[ .Size ]]",
            Version: "[[ .Version ]]",
            Tables: [[ .Tables ]],
        }
        $scope.db = { Tablename: "[[ .Tablename ]]",
                      Records: [[ .Records ]],
                      TableHeaders: [[ .TableHeaders ]],
        }

        $scope.changeTable = function(newtable) {
            $http.get("[[ .Protocol ]]://[[ .Server ]]/[[ .Username ]]/[[ .Database ]]?" + newtable)
                .then(function (response) { $scope.db = response.data; })
        }
    });
</script>
</body>
</html>